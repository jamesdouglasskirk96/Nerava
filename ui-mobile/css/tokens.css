:root{
  /* Safe-area env with fallbacks */
  --sa-top:  env(safe-area-inset-top, 0px);
  --sa-right:env(safe-area-inset-right,0px);
  --sa-bottom:env(safe-area-inset-bottom,12px);
  --sa-left: env(safe-area-inset-left, 0px);

  /* Brighter brand palette */
  --brand:        #2a6bf2;           /* lighter, friendlier blue */
  --brand-100:    #e9f1ff;
  --brand-600:    #1f57c7;
  --bolt:         #ffd000;           /* yellow lightning bolt */
  --bolt-500:     #ffca0a;

  /* Surfaces / borders tuned for light mode */
  --bg:           #f7f9fc;
  --surface:      #ffffff;
  --surface-2:    #f2f5fa;
  --text:         #0a1528;
  --muted:        #64748b;
  --border:       #e5eaf1;
  --shadow:       0 10px 30px rgba(13,31,54,.08);

  --radius-xl: 24px;
  --radius-lg: 16px;
  --radius-md: 12px;

  /* Layout metrics */
  --header-h: calc(56px + var(--sa-top));
  --nav-h:    calc(72px + var(--sa-bottom));
  --page-pad: 16px;
}

/* Prefer light overall */
@media (prefers-color-scheme: dark){
  :root{ color-scheme: light; }
}

/* Headline stripe bolt */
.header-bolt {
  color: var(--bolt);
}

/* ===== App frame ===== */
body {
  background: var(--bg);
  color: var(--text);
}

/* Map should sit behind sheet but be fully visible */
#map {
  position: fixed;
  inset: var(--sa-top) 0 calc(64px + var(--sa-bottom)) 0; /* leave room for bottom nav */
  z-index: 0;
}

/* Main sheet over map */
#sheet, .sheet {
  position: relative;
  z-index: 1;
  background: var(--surface);
  border-radius: 22px 22px 0 0;
  box-shadow: var(--shadow);
  margin: calc(8px + var(--sa-top)) 16px 0 16px;
  padding: 16px;
}

/* Page content padding so it never collides with bottom nav */
.page {
  padding-bottom: calc(96px + var(--sa-bottom));
}

/* Centered header */
.app-header {
  position: sticky; top: var(--sa-top, 0); z-index: 30;
  height: 56px; display:flex; align-items:center; justify-content:center;
  background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.75));
  backdrop-filter: blur(8px);
  border-bottom: 1px solid var(--border);
  padding: 0 12px;
}
.app-header .header-center { display:flex; align-items:center; gap: 10px; }
.app-header .brand { font-weight: 800; letter-spacing: .24em; color: var(--text); }
.app-header .bolt { color: var(--bolt, #ffd000); font-size: 18px; line-height: 1; transform: translateY(1px); }

.app-header.app-header--centered {
  position: sticky; top: var(--sa-top); z-index: 20;
  display:flex; align-items:center; justify-content:center;
  height: 56px; padding: 6px 12px;
  background: rgba(255,255,255,.9); backdrop-filter: blur(8px);
  border-bottom: 1px solid var(--border);
}
.app-header--centered .brand-lockup { 
  display:flex; align-items:center; gap:8px; 
  font-weight: 800; letter-spacing: .18em;
}
.app-header--centered .bolt { color: var(--bolt); filter: drop-shadow(0 1px 0 rgba(0,0,0,.04)); }

/* Map fills viewport behind everything */
#map{
  position:fixed; inset:0;
  top:var(--header-h); 
  bottom:var(--nav-h);
  z-index:100; /* behind sheets/nav */
}

/* ===== Venmo-style 5-tab navigation ===== */
.bottom-nav{
  position: fixed; left:0; right:0; bottom:0; z-index:25;
  height: calc(64px + var(--sa-bottom));
  padding: 8px 12px calc(8px + var(--sa-bottom)) 12px;
  background: rgba(255,255,255,.96);
  backdrop-filter: blur(10px);
  border-top: 1px solid var(--border);
  display: grid; grid-template-columns: 1fr 1fr auto 1fr 1fr; align-items: end; gap: 8px;
}
.bottom-nav .tab{
  display:flex; flex-direction:column; align-items:center; gap:4px;
  min-height:48px; padding:6px 8px; border-radius:10px; border:none; background:transparent;
  color: var(--muted); font-size:12px; font-weight:600;
}
.bottom-nav .tab.active{ color: var(--brand-600); }
.bottom-nav .tab .icon{ width:22px; height:22px; display:inline-block; background-size:contain; background-repeat:no-repeat; }
/* Center Claim button */
.bottom-nav .tab-center{
  width:56px; height:56px; border-radius:28px; align-self:center; justify-self:center;
  background: var(--brand); color:#fff; box-shadow:0 8px 18px rgba(42,107,242,.35);
  display:flex; align-items:center; justify-content:center; padding:0;
}
.bottom-nav .tab-center .icon{ width:24px; height:24px; filter: invert(1); }
/* Icon sprites */
.i-explore{ background-image:url('/app/assets/nav-explore.svg'); }
.i-charge { background-image:url('/app/assets/nav-charge.svg'); }
.i-claim  { background-image:url('/app/assets/nav-scan.svg'); }
.i-wallet { background-image:url('/app/assets/nav-wallet.svg'); }

/* Sheet over map */
.sheet{
  position:fixed; left:var(--page-pad); right:var(--page-pad);
  top: calc(var(--header-h) + 12px);
  bottom: calc(var(--nav-h) + 12px);
  z-index: 900;
  background: var(--surface);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow);
  overflow: hidden;
  display:flex; flex-direction:column;
}
.sheet-header{
  padding: 18px 18px 8px 18px;
  border-bottom: 1px solid var(--border);
}
.sheet-body{
  overflow:auto; -webkit-overflow-scrolling:touch;
  padding: 12px 14px 20px 14px;
  gap:12px; display:flex; flex-direction:column;
}

/* Explore cards inside sheet */
.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:14px;
  box-shadow: none;
}
.badge{ background:var(--brand-100); color:var(--brand); border-radius:999px; padding:6px 10px; font-weight:700; }

/* Buttons: full width on small screens, good touch targets */
.btn, .btn-primary {
  min-height: 48px;
  border-radius: 18px;
}

.btn-primary {
  background: var(--brand);
  border-color: var(--brand);
}
.btn-primary:hover { background: var(--brand-600); }

/* Pills (ports/rate) higher contrast */
.pill { 
  background: var(--brand-100);
  color: var(--brand-600);
  font-weight: 700;
}

/* Hide old banner container unless Explore is active (kept for compat) */
#dealBanner, #incentive-banner{ z-index: 1200; }

/* Pages container (only Explore uses sheet layout; others stay content) */
.page{ display:none; }
.page.active{ display:block; }

/* Charge/Wallet/Profile spacing so they sit above map safely */
.page-padded{
  position:relative; z-index: 900;
  padding: calc(var(--header-h) + 16px) var(--page-pad) calc(var(--nav-h) + 16px) var(--page-pad);
}

/* Place tile */
.place-tile{
  background: var(--surface);
  border:1px solid var(--border);
  border-radius: 16px;
  overflow:hidden;
  box-shadow: 0 6px 18px rgba(13,31,54,.06);
}
.place-img{
  position:relative;
  height:120px;
  background:#eef2f7;
}
.place-img img{
  width:100%; height:100%; object-fit:cover; display:block;
}
.place-img::after{ /* shimmer while loading */
  content:'';
  position:absolute; inset:0;
  background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.6) 50%, rgba(255,255,255,0) 100%);
  transform: translateX(-100%);
  animation: shimmer 1.2s infinite;
}
.place-img.loaded::after{ display:none; }

@keyframes shimmer {
  100% { transform: translateX(100%); }
}

.place-meta{ padding:10px 12px 12px 12px; }
.place-name{ font-weight:800; }
.place-rating{
  display:inline-flex; align-items:center; gap:6px;
  background: var(--brand-100); color: var(--brand);
  padding:4px 8px; border-radius:999px; font-weight:700; font-size:12px;
}

/* Nearby Places tiles — ensure visible height */
.place-img { height: 128px; }
.place-tile { min-height: 210px; }

/* ===== Safe area & viewport units ===== */
:root{
  --sa-top: env(safe-area-inset-top, 0px);
  --sa-right: env(safe-area-inset-right, 0px);
  --sa-bottom: env(safe-area-inset-bottom, 12px);
  --sa-left: env(safe-area-inset-left, 0px);

  /* JS fallback set in app.js (pixels of 1vh) */
  --vh: 1vh;

  /* Bright palette already added; ensure these exist: */
  --brand: #2a6bf2;
  --brand-600:#1f57c7;
  --bolt:  #ffd000;
  --bg:    #f7f9fc;
  --surface:#fff;
  --border:#e5eaf1;
  --text:  #0a1528;
  --muted: #5b6b80;
  --shadow: 0 20px 50px rgba(10,21,40,.08);

  /* New brand colors for header and controls */
  --brand-blue:#2a6bf2;
  --brand-text:#0a1528;
  --bolt-yellow:#FFD000;
  --surface-elev:#f7f9fc;
}

/* ===== Map fills viewport behind sheet & nav ===== */
#map{
  position: fixed;
  z-index: 0;
  /* Use small viewport units to ignore iOS URL bar expansion */
  top: var(--sa-top);
  left: 0; right: 0;
  height: calc(100svh - (64px + var(--sa-bottom)));
}
@supports not (height: 100svh){
  #map{ height: calc(100dvh - (64px + var(--sa-bottom))); }
}
@supports not (height: 100dvh){
  /* Legacy fallback using JS-set --vh (1vh in px) */
  #map{ height: calc((var(--vh) * 100) - (64px + var(--sa-bottom))); }
}

/* ===== Bottom sheet structure ===== */
.sheet {
  position: fixed;
  z-index: 1;
  left: 12px; right: 12px;
  bottom: calc(64px + var(--sa-bottom));
  background: var(--surface);
  border-radius: 22px;
  box-shadow: var(--shadow);
}

/* Header sticks, body scrolls */
.sheet__header{
  position: sticky; top: 0;
  background: linear-gradient(180deg, rgba(255,255,255,0.97), rgba(255,255,255,0.9));
  padding: 16px 16px 8px 16px;
  border-bottom: 1px solid var(--border);
  border-top-left-radius: 22px;
  border-top-right-radius: 22px;
  backdrop-filter: blur(6px);
  z-index: 2;
}
.sheet-handle{
  width: 56px; height: 6px; border-radius: 999px;
  background: #e7edf6; margin: 6px auto 8px;
}

/* Scroll area: clamp height to viewport */
.sheet__body{
  padding: 12px 16px 16px 16px;
  max-height: clamp(55svh, calc(100svh - 180px), 78svh);
  overflow: auto;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
  border-bottom-left-radius: 22px;
  border-bottom-right-radius: 22px;
}
@supports not (max-height: 100svh){
  .sheet__body{ max-height: clamp(55dvh, calc(100dvh - 180px), 78dvh); }
}
@supports not (max-height: 100dvh){
  .sheet__body{ max-height: calc((var(--vh) * 100) - 180px); }
}

/* Nearby Places tiles: ensure visible size */
.place-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.place-tile  { min-height: 224px; border:1px solid var(--border); border-radius:16px; background:#fff; }
.place-img   { height: 140px; border-radius:14px; background: #f2f6ff; object-fit: cover; width: 100%; }

/* Pills/buttons contrast */
.pill{ background:#eaf2ff; color:#1f57c7; font-weight:700; }
.btn-primary{ background: var(--brand); border-color: var(--brand); color:#fff; min-height:48px; border-radius:18px; }

/* ===== Bottom nav: brighter & safe-area padded ===== */
#bottom-nav{
  position: fixed; left: 0; right: 0; bottom: 0;
  z-index: 3;
  display: grid; grid-template-columns: repeat(4,1fr);
  gap: 6px;
  padding: 8px 12px calc(8px + var(--sa-bottom)) 12px;
  background: rgba(255,255,255,.96);
  backdrop-filter: blur(8px);
  border-top: 1px solid var(--border);
}
.tab { color:#37507a; font-weight:600; }
.tab.active { color: var(--brand-600); }
.tab svg, .tab img{ opacity:.95; }
.tab.active svg, .tab.active img{ opacity:1; }

/* Utility: page bottoms never collide even if not in sheet */
.page{ padding-bottom: calc(96px + var(--sa-bottom)); }

/* ===== Header: centered with yellow bolt ===== */
.app-header{
  position: sticky; top:0; z-index:20;
  padding: calc(10px + var(--sa-top)) 16px 10px;
  background: linear-gradient(180deg, rgba(255,255,255,.92) 0%, rgba(255,255,255,.75) 100%);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(10,21,40,.06);
}
.app-header .header-center{
  display:flex; align-items:center; justify-content:center; gap:10px;
  font-weight:800; letter-spacing:.28em; color:var(--brand-text);
}
.app-header .header-center .bolt{
  color: var(--bolt-yellow); filter: drop-shadow(0 1px 0 rgba(0,0,0,.1));
}

/* ===== Floating Action Buttons ===== */
.fab{
  position: fixed; z-index: 24; width:56px; height:56px; border-radius:28px;
  background:#fff; border:none; box-shadow: var(--shadow);
  display:grid; place-items:center; font-size:22px; color:var(--brand-text);
}
.fab-primary{ right:16px; bottom: calc(16px + var(--sa-bottom)); color:#fff; background:var(--brand-blue); }
.fab-secondary{ right:16px; bottom: calc(86px + var(--sa-bottom)); }
.fab-avatar{ right:16px; top: calc(10px + var(--sa-top)); width:44px; height:44px; border-radius:22px; overflow:hidden; }
.fab-avatar img{ width:100%; height:100%; object-fit:cover; }

/* ===== Account Sheet (Venmo-style) ===== */
.account-sheet::backdrop{ background: rgba(6,20,40,.35); backdrop-filter: blur(2px); }
.account-sheet{ border:none; padding:0; width:100%; max-width:480px; height:100dvh; }
.account-sheet .sheet{
  position:fixed; inset:0; background:var(--surface); border-radius:16px 16px 0 0;
  margin-top: calc(8px + var(--sa-top)); overflow:auto; box-shadow: var(--shadow);
}
.account-sheet .grip{
  width:54px; height:6px; border-radius:3px; background:rgba(10,21,40,.15);
  margin:12px auto 8px;
}
.acct-hero{ display:flex; align-items:center; gap:12px; padding:12px 16px; }
.acct-hero .avatar{ width:56px; height:56px; border-radius:28px; object-fit:cover; }
.acct-hero .who h2{ margin:0; font-size:18px; }
.acct-hero .who .sub{ margin:2px 0 0; opacity:.65; }
.wallet-card{
  margin:8px 16px; padding:16px; border-radius:14px; background:var(--surface-elev);
  display:flex; justify-content:space-between; align-items:center; gap:10px;
}
.wallet-card .amount{ font-size:32px; font-weight:800; }
.wallet-card .tier{ position:relative; height:8px; background:#e9eef6; border-radius:6px; overflow:hidden; margin-top:8px; }
.wallet-card .tier span{ position:absolute; left:0; top:0; bottom:0; width:0%; background:linear-gradient(90deg, #7dd3fc, #2a6bf2); transition:width 900ms ease; }
.activity, .social, .settings{ padding:12px 16px; }
.feed{ list-style:none; padding:0; margin:0; }
.feed li{ padding:12px 0; border-bottom:1px solid rgba(10,21,40,.08); }
.following{ display:flex; gap:10px; overflow-x:auto; padding-bottom:8px; }
.following img{ width:44px; height:44px; border-radius:22px; object-fit:cover; box-shadow: var(--shadow); }
.btn.solid{ background:var(--brand-blue); color:#fff; border:none; border-radius:10px; padding:10px 12px; box-shadow: var(--shadow); }
.pill.small{ border:1px solid rgba(10,21,40,.12); background:#fff; padding:6px 10px; border-radius:999px; font-weight:600; }

/* ===== No-nav layout adjustments ===== */
.app-root.no-nav{
  padding-bottom: calc(12px + var(--sa-bottom));
}

/* Ensure Explore card never collides with bottom fab */
.sheet-explore{ padding-bottom: calc(120px + var(--sa-bottom)); }

/* Raise nearby card contrast slightly */
.place .title{ color:var(--brand-text); font-weight:800; }
.place .rating{ color:#1d4ed8; background:#e8f0ff; }

/* Pulse helper for CTA hint */
@keyframes pulseOnce{ 0%{transform:scale(1)} 40%{transform:scale(1.04)} 100%{transform:scale(1)} }
.pulse{ animation: pulseOnce 600ms ease; }

/* —— Bottom Nav & Scan —— */
:root {
  --nav-height: 64px;
  --nav-bg: rgba(255,255,255,.96);
  --nav-border: var(--border);
  --nav-text: var(--muted);
  --nav-text-active: var(--brand-600);
  --scan-size: 56px; /* center FAB */
  --scan-shadow: 0 10px 24px rgba(42,107,242,.35);
}

/* Bottom nav container */
.bottom-nav {
  position: fixed; left: 0; right: 0; bottom: 0;
  height: calc(var(--nav-height) + var(--sa-bottom));
  padding: 8px 8px calc(8px + var(--sa-bottom)) 8px;
  display: grid; grid-template-columns: 1fr 1fr auto 1fr 1fr; align-items: end;
  background: var(--nav-bg);
  backdrop-filter: blur(10px);
  border-top: 1px solid var(--nav-border);
  z-index: 25;
}

/* Tabs */
.nav-tab {
  display: inline-flex; flex-direction: column; align-items: center; gap: 4px;
  justify-self: center; min-width: 64px; min-height: 48px;
  padding: 6px 8px; border-radius: 10px;
  color: var(--nav-text); background: transparent; border: 0;
  font-size: 12px; font-weight: 600;
}
.nav-tab svg, .nav-tab img.icon { width: 22px; height: 22px; }
.nav-tab.active { color: var(--nav-text-active); }

/* Center FAB (Scan) */
.nav-scan {
  justify-self: center; align-self: start;
  width: var(--scan-size); height: var(--scan-size);
  border-radius: 999px; border: 0;
  background: var(--brand); color: #fff;
  display: grid; place-items: center;
  box-shadow: var(--scan-shadow);
  transform: translateY(-18px);
}
.nav-scan:active { transform: translateY(-16px) scale(.98); }

/* Focus ring */
.nav-tab:focus-visible, .nav-scan:focus-visible {
  outline: 2px solid var(--brand); outline-offset: 2px; border-radius: 12px;
}

/* Pages need extra bottom padding so content never hides behind nav */
.page {
  padding-bottom: calc(var(--nav-height) + 16px + var(--sa-bottom));
}

/* Scan modal styles */
.scan-viewport { width: 100%; aspect-ratio: 3/4; background: #000; border-radius: 16px; overflow: hidden; }
.sep.or { text-align: center; color: var(--muted); }

/* Claim page styles */
.claim-status { 
  padding: 12px; margin: 8px 0; border-radius: 8px; 
  background: var(--brand-100); color: var(--brand-600); 
  text-align: center; font-weight: 600; 
}
.incentives-list { margin-top: 16px; }
.incentive-card { 
  display: flex; justify-content: space-between; align-items: center;
  padding: 12px; margin: 8px 0; border: 1px solid var(--border); 
  border-radius: 12px; background: var(--surface);
}
.incentive-card.claimable { border-color: var(--brand); background: var(--brand-100); }
.incentive-card .claim-btn { 
  padding: 8px 16px; background: var(--brand); color: white; 
  border: none; border-radius: 8px; font-weight: 600;
}
.incentive-card .claim-btn:disabled { 
  background: var(--muted); color: white; opacity: 0.5; 
}

/* Leaderboard styles */
.leaderboard-list { margin-top: 12px; }
.leaderboard-item {
  display: flex; align-items: center; gap: 12px;
  padding: 12px; margin: 8px 0; border-radius: 12px;
  background: var(--surface); border: 1px solid var(--border);
}
.leaderboard-item.rank-1 { background: linear-gradient(135deg, #ffd700, #ffed4e); }
.leaderboard-item.rank-2 { background: linear-gradient(135deg, #c0c0c0, #e8e8e8); }
.leaderboard-item.rank-3 { background: linear-gradient(135deg, #cd7f32, #daa520); }
.leaderboard-rank {
  font-weight: 800; font-size: 18px; min-width: 24px;
  color: var(--text);
}
.leaderboard-avatar {
  width: 40px; height: 40px; border-radius: 20px;
  background: var(--brand); display: flex; align-items: center; justify-content: center;
  color: white; font-weight: 600; font-size: 16px;
}
.leaderboard-info { flex: 1; }
.leaderboard-name { font-weight: 600; margin-bottom: 2px; }
.leaderboard-stats { font-size: 14px; color: var(--muted); }
.leaderboard-score {
  font-weight: 700; font-size: 16px; color: var(--brand);
}

/* Explore minimal sheet */
.perk-sheet {
  position: fixed;
  left: 12px; right: 12px;
  bottom: calc(12px + var(--sa-bottom) + var(--nav-height, 72px));
  background: var(--surface);
  border-radius: 20px;
  box-shadow: var(--shadow);
  z-index: 14;
  padding: 10px 12px 12px;
}

.perk-sheet__handle {
  width: 44px; height: 5px; border-radius: 999px;
  background: rgba(0,0,0,.1); margin: 6px auto 10px;
}

.perk-sheet__title { font-size: 16px; margin: 0 0 8px; color: var(--text); }

.perk-card {
  display: flex; align-items: center; justify-content: space-between;
  gap: 12px; padding: 10px; border: 1px solid var(--border);
  border-radius: 14px; background: var(--surface-2);
}

.perk-card__left { display: flex; align-items: center; gap: 10px; }
.perk-card__icon { width: 40px; height: 40px; border-radius: 10px; }

.perk-card__merchant { font-weight: 700; color: var(--text); }
.perk-card__subtitle { font-size: 13px; color: var(--muted); }
.perk-card__distance { font-size: 12px; color: var(--muted); margin-top: 2px; }

.route-meta {
  display: flex; align-items: center; gap: 8px;
  font-size: 13px; color: var(--muted); margin-top: 10px;
}
.route-meta .dot { opacity: .5; }

/* Payout history styles */
.payout-list {
  display: flex; flex-direction: column; gap: 8px;
}
.payout-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px; border: 1px solid var(--border); border-radius: 12px;
  background: var(--surface);
}
.payout-info {
  display: flex; flex-direction: column; gap: 4px;
}
.payout-amount {
  font-weight: 700; font-size: 16px; color: var(--text);
}
.payout-card {
  font-size: 14px; color: var(--muted);
}
.payout-status {
  padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 600;
}
.payout-status.completed {
  background: var(--success-100); color: var(--success-600);
}
.payout-status.pending {
  background: var(--warning-100); color: var(--warning-600);
}
.payout-status.failed {
  background: var(--danger-100); color: var(--danger-600);
}
.payout-date {
  font-size: 12px; color: var(--muted); margin-top: 4px;
}