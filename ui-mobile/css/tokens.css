:root{
  /* Safe-area env with fallbacks */
  --sa-top:  env(safe-area-inset-top, 0px);
  --sa-right:env(safe-area-inset-right,0px);
  --sa-bottom:env(safe-area-inset-bottom,12px);
  --sa-left: env(safe-area-inset-left, 0px);

  /* Brighter brand palette */
  --brand:        #2a6bf2;           /* lighter, friendlier blue */
  --brand-100:    #e9f1ff;
  --brand-600:    #1f57c7;
  --bolt:         #ffd000;           /* yellow lightning bolt */
  --bolt-500:     #ffca0a;

  /* Surfaces / borders tuned for light mode */
  --bg:           #f7f9fc;
  --surface:      #ffffff;
  --surface-2:    #f2f5fa;
  --text:         #0a1528;
  --muted:        #64748b;
  --border:       #e5eaf1;
  --shadow:       0 10px 30px rgba(13,31,54,.08);

  --radius-xl: 24px;
  --radius-lg: 16px;
  --radius-md: 12px;

  /* Layout metrics */
  --header-h: calc(56px + var(--sa-top));
  --nav-h:    calc(72px + var(--sa-bottom));
  --page-pad: 16px;
}

/* Prefer light overall */
@media (prefers-color-scheme: dark){
  :root{ color-scheme: light; }
}

/* Headline stripe bolt */
.header-bolt {
  color: var(--bolt);
}

/* ===== App frame ===== */
body {
  background: var(--bg);
  color: var(--text);
}

/* Map should sit behind sheet but be fully visible */
#map {
  position: fixed;
  inset: var(--sa-top) 0 calc(64px + var(--sa-bottom)) 0; /* leave room for bottom nav */
  z-index: 0;
}

/* Main sheet over map */
#sheet, .sheet {
  position: relative;
  z-index: 1;
  background: var(--surface);
  border-radius: 22px 22px 0 0;
  box-shadow: var(--shadow);
  margin: calc(8px + var(--sa-top)) 16px 0 16px;
  padding: 16px;
}

/* Page content padding so it never collides with bottom nav */
.page {
  padding-bottom: calc(96px + var(--sa-bottom));
}

/* Bright header */
.app-header{
  position:fixed; top:0; left:0; right:0; z-index:1000;
  height:var(--header-h);
  padding: calc(env(safe-area-inset-top,0px) + 8px) 20px 8px 20px;
  display:flex; align-items:flex-end; gap:8px;
  background:var(--surface); border-bottom:1px solid var(--border);
}
.app-title{ font-size:20px; letter-spacing:0.22em; font-weight:800; }
.app-bolt{
  width:16px; height:16px; margin-left:6px; display:inline-block;
  background: conic-gradient(from 180deg, var(--accent), #ffe781);
  -webkit-mask: url('/icons/bolt.svg') no-repeat center / contain;
          mask: url('/icons/bolt.svg') no-repeat center / contain;
}

/* Map fills viewport behind everything */
#map{
  position:fixed; inset:0;
  top:var(--header-h); 
  bottom:var(--nav-h);
  z-index:100; /* behind sheets/nav */
}

/* ===== Bottom nav: brighter icons/text ===== */
#bottom-nav {
  position: fixed;
  left: 0; right: 0; bottom: 0;
  padding: 8px 12px calc(8px + var(--sa-bottom)) 12px;
  background: rgba(255,255,255,.94);
  backdrop-filter: blur(8px);
  border-top: 1px solid var(--border);
  z-index: 2;
}

.tab {
  color: #37507a;                     /* brighter default */
  filter: none;
}

.tab.active {
  color: var(--brand-600);
  font-weight: 700;
  text-shadow: 0 0 0 transparent;
}

/* If the icons are inline SVGs, tint them */
.tab svg, .tab img {
  opacity: .95;
}
.tab.active svg, .tab.active img{
  filter: none;
  opacity: 1;
}

/* Sheet over map */
.sheet{
  position:fixed; left:var(--page-pad); right:var(--page-pad);
  top: calc(var(--header-h) + 12px);
  bottom: calc(var(--nav-h) + 12px);
  z-index: 900;
  background: var(--surface);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow);
  overflow: hidden;
  display:flex; flex-direction:column;
}
.sheet-header{
  padding: 18px 18px 8px 18px;
  border-bottom: 1px solid var(--border);
}
.sheet-body{
  overflow:auto; -webkit-overflow-scrolling:touch;
  padding: 12px 14px 20px 14px;
  gap:12px; display:flex; flex-direction:column;
}

/* Explore cards inside sheet */
.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:14px;
  box-shadow: none;
}
.badge{ background:var(--brand-100); color:var(--brand); border-radius:999px; padding:6px 10px; font-weight:700; }

/* Buttons: full width on small screens, good touch targets */
.btn, .btn-primary {
  min-height: 48px;
  border-radius: 18px;
}

.btn-primary {
  background: var(--brand);
  border-color: var(--brand);
}
.btn-primary:hover { background: var(--brand-600); }

/* Pills (ports/rate) higher contrast */
.pill { 
  background: var(--brand-100);
  color: var(--brand-600);
  font-weight: 700;
}

/* Hide old banner container unless Explore is active (kept for compat) */
#dealBanner, #incentive-banner{ z-index: 1200; }

/* Pages container (only Explore uses sheet layout; others stay content) */
.page{ display:none; }
.page.active{ display:block; }

/* Charge/Wallet/Profile spacing so they sit above map safely */
.page-padded{
  position:relative; z-index: 900;
  padding: calc(var(--header-h) + 16px) var(--page-pad) calc(var(--nav-h) + 16px) var(--page-pad);
}

/* Place tile */
.place-tile{
  background: var(--surface);
  border:1px solid var(--border);
  border-radius: 16px;
  overflow:hidden;
  box-shadow: 0 6px 18px rgba(13,31,54,.06);
}
.place-img{
  position:relative;
  height:120px;
  background:#eef2f7;
}
.place-img img{
  width:100%; height:100%; object-fit:cover; display:block;
}
.place-img::after{ /* shimmer while loading */
  content:'';
  position:absolute; inset:0;
  background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.6) 50%, rgba(255,255,255,0) 100%);
  transform: translateX(-100%);
  animation: shimmer 1.2s infinite;
}
.place-img.loaded::after{ display:none; }

@keyframes shimmer {
  100% { transform: translateX(100%); }
}

.place-meta{ padding:10px 12px 12px 12px; }
.place-name{ font-weight:800; }
.place-rating{
  display:inline-flex; align-items:center; gap:6px;
  background: var(--brand-100); color: var(--brand);
  padding:4px 8px; border-radius:999px; font-weight:700; font-size:12px;
}

/* Nearby Places tiles â€” ensure visible height */
.place-img { height: 128px; }
.place-tile { min-height: 210px; }

/* ===== Safe area & viewport units ===== */
:root{
  --sa-top: env(safe-area-inset-top, 0px);
  --sa-right: env(safe-area-inset-right, 0px);
  --sa-bottom: env(safe-area-inset-bottom, 12px);
  --sa-left: env(safe-area-inset-left, 0px);

  /* JS fallback set in app.js (pixels of 1vh) */
  --vh: 1vh;

  /* Bright palette already added; ensure these exist: */
  --brand: #2a6bf2;
  --brand-600:#1f57c7;
  --bolt:  #ffd000;
  --bg:    #f7f9fc;
  --surface:#fff;
  --border:#e5eaf1;
  --text:  #0a1528;
  --muted: #5b6b80;
  --shadow: 0 20px 50px rgba(10,21,40,.08);

  /* New brand colors for header and controls */
  --brand-blue:#2a6bf2;
  --brand-text:#0a1528;
  --bolt-yellow:#FFD000;
  --surface-elev:#f7f9fc;
}

/* ===== Map fills viewport behind sheet & nav ===== */
#map{
  position: fixed;
  z-index: 0;
  /* Use small viewport units to ignore iOS URL bar expansion */
  top: var(--sa-top);
  left: 0; right: 0;
  height: calc(100svh - (64px + var(--sa-bottom)));
}
@supports not (height: 100svh){
  #map{ height: calc(100dvh - (64px + var(--sa-bottom))); }
}
@supports not (height: 100dvh){
  /* Legacy fallback using JS-set --vh (1vh in px) */
  #map{ height: calc((var(--vh) * 100) - (64px + var(--sa-bottom))); }
}

/* ===== Bottom sheet structure ===== */
.sheet {
  position: fixed;
  z-index: 1;
  left: 12px; right: 12px;
  bottom: calc(64px + var(--sa-bottom));
  background: var(--surface);
  border-radius: 22px;
  box-shadow: var(--shadow);
}

/* Header sticks, body scrolls */
.sheet__header{
  position: sticky; top: 0;
  background: linear-gradient(180deg, rgba(255,255,255,0.97), rgba(255,255,255,0.9));
  padding: 16px 16px 8px 16px;
  border-bottom: 1px solid var(--border);
  border-top-left-radius: 22px;
  border-top-right-radius: 22px;
  backdrop-filter: blur(6px);
  z-index: 2;
}
.sheet-handle{
  width: 56px; height: 6px; border-radius: 999px;
  background: #e7edf6; margin: 6px auto 8px;
}

/* Scroll area: clamp height to viewport */
.sheet__body{
  padding: 12px 16px 16px 16px;
  max-height: clamp(55svh, calc(100svh - 180px), 78svh);
  overflow: auto;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
  border-bottom-left-radius: 22px;
  border-bottom-right-radius: 22px;
}
@supports not (max-height: 100svh){
  .sheet__body{ max-height: clamp(55dvh, calc(100dvh - 180px), 78dvh); }
}
@supports not (max-height: 100dvh){
  .sheet__body{ max-height: calc((var(--vh) * 100) - 180px); }
}

/* Nearby Places tiles: ensure visible size */
.place-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.place-tile  { min-height: 224px; border:1px solid var(--border); border-radius:16px; background:#fff; }
.place-img   { height: 140px; border-radius:14px; background: #f2f6ff; object-fit: cover; width: 100%; }

/* Pills/buttons contrast */
.pill{ background:#eaf2ff; color:#1f57c7; font-weight:700; }
.btn-primary{ background: var(--brand); border-color: var(--brand); color:#fff; min-height:48px; border-radius:18px; }

/* ===== Bottom nav: brighter & safe-area padded ===== */
#bottom-nav{
  position: fixed; left: 0; right: 0; bottom: 0;
  z-index: 3;
  display: grid; grid-template-columns: repeat(4,1fr);
  gap: 6px;
  padding: 8px 12px calc(8px + var(--sa-bottom)) 12px;
  background: rgba(255,255,255,.96);
  backdrop-filter: blur(8px);
  border-top: 1px solid var(--border);
}
.tab { color:#37507a; font-weight:600; }
.tab.active { color: var(--brand-600); }
.tab svg, .tab img{ opacity:.95; }
.tab.active svg, .tab.active img{ opacity:1; }

/* Utility: page bottoms never collide even if not in sheet */
.page{ padding-bottom: calc(96px + var(--sa-bottom)); }

/* ===== Header: centered with yellow bolt ===== */
.app-header{
  position: sticky; top:0; z-index:20;
  padding: calc(10px + var(--sa-top)) 16px 10px;
  background: linear-gradient(180deg, rgba(255,255,255,.92) 0%, rgba(255,255,255,.75) 100%);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(10,21,40,.06);
}
.app-header .header-center{
  display:flex; align-items:center; justify-content:center; gap:10px;
  font-weight:800; letter-spacing:.28em; color:var(--brand-text);
}
.app-header .header-center .bolt{
  color: var(--bolt-yellow); filter: drop-shadow(0 1px 0 rgba(0,0,0,.1));
}

/* ===== Floating Action Buttons ===== */
.fab{
  position: fixed; z-index: 24; width:56px; height:56px; border-radius:28px;
  background:#fff; border:none; box-shadow: var(--shadow);
  display:grid; place-items:center; font-size:22px; color:var(--brand-text);
}
.fab-primary{ right:16px; bottom: calc(16px + var(--sa-bottom)); color:#fff; background:var(--brand-blue); }
.fab-secondary{ right:16px; bottom: calc(86px + var(--sa-bottom)); }
.fab-avatar{ right:16px; top: calc(10px + var(--sa-top)); width:44px; height:44px; border-radius:22px; overflow:hidden; }
.fab-avatar img{ width:100%; height:100%; object-fit:cover; }

/* ===== Account Sheet (Venmo-style) ===== */
.account-sheet::backdrop{ background: rgba(6,20,40,.35); backdrop-filter: blur(2px); }
.account-sheet{ border:none; padding:0; width:100%; max-width:480px; height:100dvh; }
.account-sheet .sheet{
  position:fixed; inset:0; background:var(--surface); border-radius:16px 16px 0 0;
  margin-top: calc(8px + var(--sa-top)); overflow:auto; box-shadow: var(--shadow);
}
.account-sheet .grip{
  width:54px; height:6px; border-radius:3px; background:rgba(10,21,40,.15);
  margin:12px auto 8px;
}
.acct-hero{ display:flex; align-items:center; gap:12px; padding:12px 16px; }
.acct-hero .avatar{ width:56px; height:56px; border-radius:28px; object-fit:cover; }
.acct-hero .who h2{ margin:0; font-size:18px; }
.acct-hero .who .sub{ margin:2px 0 0; opacity:.65; }
.wallet-card{
  margin:8px 16px; padding:16px; border-radius:14px; background:var(--surface-elev);
  display:flex; justify-content:space-between; align-items:center; gap:10px;
}
.wallet-card .amount{ font-size:32px; font-weight:800; }
.wallet-card .tier{ position:relative; height:8px; background:#e9eef6; border-radius:6px; overflow:hidden; margin-top:8px; }
.wallet-card .tier span{ position:absolute; left:0; top:0; bottom:0; width:0%; background:linear-gradient(90deg, #7dd3fc, #2a6bf2); transition:width 900ms ease; }
.activity, .social, .settings{ padding:12px 16px; }
.feed{ list-style:none; padding:0; margin:0; }
.feed li{ padding:12px 0; border-bottom:1px solid rgba(10,21,40,.08); }
.following{ display:flex; gap:10px; overflow-x:auto; padding-bottom:8px; }
.following img{ width:44px; height:44px; border-radius:22px; object-fit:cover; box-shadow: var(--shadow); }
.btn.solid{ background:var(--brand-blue); color:#fff; border:none; border-radius:10px; padding:10px 12px; box-shadow: var(--shadow); }
.pill.small{ border:1px solid rgba(10,21,40,.12); background:#fff; padding:6px 10px; border-radius:999px; font-weight:600; }

/* ===== No-nav layout adjustments ===== */
.app-root.no-nav{
  padding-bottom: calc(12px + var(--sa-bottom));
}

/* Ensure Explore card never collides with bottom fab */
.sheet-explore{ padding-bottom: calc(120px + var(--sa-bottom)); }

/* Raise nearby card contrast slightly */
.place .title{ color:var(--brand-text); font-weight:800; }
.place .rating{ color:#1d4ed8; background:#e8f0ff; }

/* Pulse helper for CTA hint */
@keyframes pulseOnce{ 0%{transform:scale(1)} 40%{transform:scale(1.04)} 100%{transform:scale(1)} }
.pulse{ animation: pulseOnce 600ms ease; }