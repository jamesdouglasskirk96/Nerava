# Nerava Backend Environment Variables
# Copy this file to .env and fill in your values

# Square API Configuration
SQUARE_ENV=sandbox
SQUARE_ACCESS_TOKEN=REPLACE_ME
SQUARE_LOCATION_ID=REPLACE_ME
SQUARE_WEBHOOK_SIGNATURE_KEY=REPLACE_ME
SQUARE_APPLICATION_ID=REPLACE_ME

# Database Configuration
DATABASE_URL=sqlite:///./nerava.db

# Production Database (uncomment for PostgreSQL)
# DATABASE_URL=postgresql://user:password@localhost:5432/nerava

# Redis Configuration
REDIS_URL=redis://localhost:6379/0

# Public API Base URL (for redirects and webhooks)
PUBLIC_BASE_URL=http://127.0.0.1:8001

# CORS Configuration (comma-separated list of origins, e.g., https://nerava.network,https://app.nerava.network)
ALLOWED_ORIGINS=*

# Development Settings
DEV_WEBHOOK_BYPASS=true
DEMO_USER_ID=user-demo-1

# Demo QR Settings (for sandbox demo flows)
DEMO_QR_ENABLED=true
DEMO_EGGMAN_QR_TOKEN=eggman-demo-token-123

# Dev-only: allow anonymous driver in local dev. DO NOT enable in production.
# When set to true, driver endpoints will use driver_id=1 as fallback when no auth token is provided.
NERAVA_DEV_ALLOW_ANON_DRIVER=false

# Dev-only: allow anonymous user in local dev. DO NOT enable in production.
# When set to true, endpoints using get_current_user will use user_id=1 as fallback when no auth token is provided.
NERAVA_DEV_ALLOW_ANON_USER=false

# Logging
LOG_LEVEL=INFO

# Error Tracking (Sentry)
# Set SENTRY_DSN to enable error tracking in non-local environments
# Get your DSN from https://sentry.io/
# SENTRY_DSN=https://your-key@sentry.io/your-project-id

# Request Settings
REQUEST_TIMEOUT_S=5
RATE_LIMIT_PER_MINUTE=120

# EnergyHub
ENERGYHUB_ALLOW_DEMO_AT=true
CACHE_TTL_WINDOWS=60

# Region
REGION=local
PRIMARY_REGION=local

# Events
EVENTS_DRIVER=inproc

# Feature Flags
ENABLE_SYNC_CREDIT=false

# Frontend URL for OAuth redirects and callbacks
FRONTEND_URL=http://localhost:8001/app

# Smartcar EV Integration
# Register callback URL in Smartcar dashboard: {your-backend-url}/oauth/smartcar/callback
# For local dev, use a tunnel (Cloudflare Tunnel, ngrok) to expose localhost:8001
SMARTCAR_CLIENT_ID=
SMARTCAR_CLIENT_SECRET=
SMARTCAR_MODE=sandbox
SMARTCAR_REDIRECT_URI=https://your-tunnel-domain/oauth/smartcar/callback
# SMARTCAR_STATE_SECRET: Secret for OAuth state JWT (CSRF protection)
# Generate with: openssl rand -hex 16
SMARTCAR_STATE_SECRET=
# SMARTCAR_ENABLED: Feature flag to enable/disable Smartcar integration (default: false for production)
SMARTCAR_ENABLED=false

# Google Places API (New) Configuration
# Get your API key from https://console.cloud.google.com/google/maps-apis
GOOGLE_PLACES_API_KEY=

# Intent Capture Configuration
# Location accuracy threshold in meters (reject requests with worse accuracy)
LOCATION_ACCURACY_THRESHOLD_M=100
# Number of intent sessions before requiring vehicle onboarding
INTENT_SESSION_ONBOARDING_THRESHOLD=3
# Confidence tier thresholds (in meters)
CONFIDENCE_TIER_A_THRESHOLD_M=120
CONFIDENCE_TIER_B_THRESHOLD_M=400
# Google Places search radius for merchants (in meters)
GOOGLE_PLACES_SEARCH_RADIUS_M=800
# Merchant cache TTL (in seconds, default 1 hour)
MERCHANT_CACHE_TTL_SECONDS=3600
# Vehicle onboarding photo retention (in days, default 90)
VEHICLE_ONBOARDING_RETENTION_DAYS=90

# Testing
# MOCK_PLACES: Set to 'true' to return fixture merchants for deterministic testing
MOCK_PLACES=false

# Analytics Configuration
# PostHog: Product analytics (high-volume, event analytics)
POSTHOG_KEY=
POSTHOG_HOST=https://app.posthog.com
# HubSpot: CRM lifecycle events (low-volume, CRM)
HUBSPOT_ACCESS_TOKEN=
# Enable/disable analytics (set to 'false' to disable all analytics)
ANALYTICS_ENABLED=true
# Environment: dev, staging, prod
ENV=dev

# ============================================================================
# PRODUCTION DEPLOYMENT CHECKLIST
# ============================================================================
# When deploying to production (ENV=prod), ensure the following:
#
# REQUIRED CHANGES:
# 1. DATABASE_URL: Must be PostgreSQL (NOT sqlite://)
#    Example: DATABASE_URL=postgresql://user:password@host:5432/nerava
#
# 2. JWT_SECRET: Must be set to a secure random value (NOT "dev-secret-change-me")
#    Generate with: python -c 'import secrets; print(secrets.token_urlsafe(32))'
#
# 3. TOKEN_ENCRYPTION_KEY: Must be a valid Fernet key (44 characters)
#    Generate with: python -c 'from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())'
#
# 4. PUBLIC_BASE_URL: Must be production API domain (NOT localhost)
#    Example: PUBLIC_BASE_URL=https://api.nerava.network
#
# 5. FRONTEND_URL: Must be production frontend domain (NOT localhost)
#    Example: FRONTEND_URL=https://app.nerava.network
#
# 6. ALLOWED_ORIGINS: Must be explicit origins (NOT "*")
#    Example: ALLOWED_ORIGINS=https://app.nerava.network,https://www.nerava.network,https://merchant.nerava.network
#
# 7. ALLOWED_HOSTS: Must be set for TrustedHostMiddleware
#    Example: ALLOWED_HOSTS=api.nerava.network,*.nerava.network
#
# FORBIDDEN VALUES IN PRODUCTION:
# - OTP_PROVIDER=stub (must be twilio_verify or twilio_sms)
# - MERCHANT_AUTH_MOCK=true (must be false)
# - DEMO_MODE=true (must be false)
# - ALLOWED_ORIGINS=* (must be explicit list)
# - DATABASE_URL starting with sqlite:// (must be PostgreSQL)
# - PUBLIC_BASE_URL containing localhost or 127.0.0.1
# - FRONTEND_URL containing localhost or 127.0.0.1
#
# VALIDATION:
# The application will fail to start in production if any of the above
# forbidden values are detected. Check logs for specific validation errors.
# ============================================================================
